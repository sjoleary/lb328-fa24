clean_names()
schb_2410 <- read_delim("data/macros_SCHB_2024-10-23.tsv", delim = "\t") %>%
clean_names()
kable(
rand_2410 %>%
group_by(order) %>%
count() %>%
ungroup() %>%
mutate(rel_abund = round(n/sum(n)*100, digits = 1))
)
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410)
View(macros)
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(sample_bout = glue("{site_id}_{date}"))
library(glue)
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(sample_bout = glue("{site_id}_{date}"))
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date)
year = year(sample_date)
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date))
View(macros)
sample_bout = glue("{site_id}_{year}-{month}"))
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}"))
View(macros)
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(location, date, order) %>%
count() %>%
ungroup()
bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(site_ide, sample_date, order) %>%
count() %>%
ungroup()
bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(site_id, sample_date, order) %>%
count() %>%
ungroup()
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(site_id, sample_date, order) %>%
count() %>%
ungroup() %>%
group_by(site_id, sample_date) %>%
mutate(rel_abund = round(n/sum(n)*100, digits = 1))
View(macros)
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile()
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(sample_bout, order) %>%
count() %>%
ungroup() %>%
group_by(sample_bout) %>%
mutate(rel_abund = round(n/sum(n)*100, digits = 1))
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile()
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c()
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme_bw()
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme_classic()
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme_classic() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c() +
facet_grid(. ~ site_id) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "A") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "B") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "C") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "D") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "F") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "G") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "H") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "H", direction = 1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "G", direction = 1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "F", direction = 1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "F", direction = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(sample_bout, order) %>%
count() %>%
ungroup() %>%
group_by(sample_bout) %>%
mutate(rel_abund = round(n/sum(n)*100, digits = 1)) %>%
separate(sample_bout, into = c("site_id", "year", "month"))
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410) %>%
mutate(month = month(sample_date),
year = year(sample_date),
sample_bout = glue("{site_id}_{year}-{month}")) %>%
group_by(sample_bout, order) %>%
count() %>%
ungroup() %>%
group_by(sample_bout) %>%
mutate(rel_abund = round(n/sum(n)*100, digits = 1)) %>%
separate(sample_bout, into = c("site_id", "year", "month"), remove = FALSE)
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(. ~ site_id) %>%
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
View(macros)
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(site_id ~ .) %>%
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(site_id ~ .) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(. ~ site_id) +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(. ~ site_id, scales = "free") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
ggplot(macros, aes(x = sample_bout, y = order, fill = rel_abund)) +
geom_tile() +
scale_fill_viridis_c(option = "E", direction = -1) +
facet_grid(. ~ site_id, scales = "free", space = "free") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
legend.position = "bottom")
# read libraries
library(readr)
library(janitor)
library(lubridate)
library(tidyr)
library(dplyr)
library(glue)
library(ggplot2)
library(patchwork)
library(knitr)
rand_2210 <- read_delim("data/macros_RAND_2022-10-19.tsv", delim = "\t") %>%
clean_names()
rand_2305 <- read_delim("data/macros_RAND_2023-05-30.tsv", delim = "\t") %>%
clean_names()
rand_2307 <- read_delim("data/macros_RAND_2023-07-07.tsv", delim = "\t") %>%
clean_names()
rand_2310 <- read_delim("data/macros_RAND_2023-10-18.tsv", delim = "\t") %>%
clean_names()
rand_2407 <- read_delim("data/macros_RAND_2024-07-09.tsv", delim = "\t") %>%
clean_names()
rand_2410 <- read_delim("data/macros_RAND_2024-10-02.tsv", delim = "\t") %>%
clean_names()
schb_2210 <- read_delim("data/macros_SCHB_2022-11-02.tsv", delim = "\t") %>%
clean_names()
schb_2305 <- read_delim("data/macros_SCHB_2023-05-30.tsv", delim = "\t") %>%
clean_names()
schb_2410 <- read_delim("data/macros_SCHB_2024-10-23.tsv", delim = "\t") %>%
clean_names()
macros <- bind_rows(rand_2210,
rand_2305,
rand_2307,
rand_2310,
rand_2407,
rand_2410,
schb_2210,
schb_2305,
schb_2410)
kable(
macros %>%
mutate(EPT = ifelse(order %in% c("Ephemeroptera", "Plecoptera", "Trichoptera"), "EPT", "non-EPT")) %>%
group_by(site_id, sample_date, EPT) %>%
count() %>%
ungroup() %>%
group_by(EPT) %>%
mutate(EPT_index = n/(sum(n))) %>%
filter(EPT == "EPT")
)
kable(
macros %>%
mutate(EPT = ifelse(order %in% c("Ephemeroptera", "Plecoptera", "Trichoptera"), "EPT", "non-EPT")) %>%
group_by(site_id, sample_date, EPT) %>%
count() %>%
ungroup() %>%
group_by(EPT) %>%
mutate(EPT_index = n/(sum(n))) %>%
filter(EPT == "EPT")
)
kable(
macros %>%
mutate(EPT = ifelse(order %in% c("Ephemeroptera", "Plecoptera", "Trichoptera"), "EPT", "non-EPT")) %>%
group_by(site_id, sample_date, EPT) %>%
count() %>%
ungroup() %>%
group_by(EPT) %>%
mutate(EPT_index = n/(sum(n))) %>%
filter(EPT == "EPT"),
digits = 3
)
macros %>%
mutate(EPT = ifelse(order %in% c("Ephemeroptera", "Plecoptera", "Trichoptera"), "EPT", "non-EPT")) %>%
group_by(site_id, sample_date, EPT) %>%
count() %>%
ungroup()
kable(
macros %>%
mutate(EPT = ifelse(order %in% c("Ephemeroptera", "Plecoptera", "Trichoptera"), "EPT", "non-EPT")) %>%
group_by(site_id, sample_date, EPT) %>%
count() %>%
ungroup() %>%
group_by(site_id, sample_date) %>%
mutate(EPT_index = n/(sum(n))) %>%
filter(EPT == "EPT"),
digits = 3
)
tolerance <- read_delim("data/macros_family-tolerance.csv", delim = ",")
View(tolerance)
left_join(tolerance) %>% View()
macros %>%
left_join(tolerance)
macros %>%
left_join(tolerance) %>% View()
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, pollution_tolerance) %>%
count()
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count()
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance) %>%
ungroup()
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance) %>%
ungroup() %>%
group_by(site_id) %>%
summarize(HSI = sum(weighted_abund)/sum(n))
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance)
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance) %>%
ungroup() %>%
group_by(site_id, sample_date)
kable(
macros %>%
left_join(tolerance) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance) %>%
ungroup() %>%
group_by(site_id, sample_date) %>%
summarize(HSI = sum(weighted_abund)/sum(n)),
digits = 2)
kable(
macros %>%
left_join(tolerance) %>%
filter(!is.na(tolerance)) %>%
group_by(site_id, sample_date, family, tolerance) %>%
count() %>%
mutate(weighted_abund = n*tolerance) %>%
ungroup() %>%
group_by(site_id, sample_date) %>%
summarize(HSI = sum(weighted_abund)/sum(n)),
digits = 2)
